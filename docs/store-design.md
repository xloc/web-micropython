# Pinia Store Design

- useLayoutStore — Layout: panel divisions, console toggle, layout reset.
  - State: `divisions: [number, number]`, `consoleVisible: boolean`, `explorerVisible: boolean`
  - Derived: `fileExplorerWidth`, `editorWidth`, `consoleWidth`
  - Action: `updateDivision(index, value)` (use original implementation)
- useSerialStore — Web Serial connect/open/init; shell interface with exclusive console/session routing.
  - State:
    - `settings: { baudRate, dataBits, parity, stopBits, flowControl }`
    - `busy: null | { reason: string; detail?: string }`
  - Derived:
    - `isConnected`
  - API:
    - `connect()`, `disconnect()`
    - `getConsoleShell(): { send, onData, resize? }`
    - `openSession(reason): { send, onData, close }`
  - Note: Console shell is paused during a session; closing session restores console routing.
- useWorkspaceStore — Workspace: file tree and open tabs; manages open/active docs and file operations.
  - State:
    - `fileTree: FileNode | null`
    - `openTabs: Array<{ path, content, isDirty, lastSaved }>`
    - `activePath: string | null`
    - `loading: boolean`
    - `error: string | null`
  - Derived:
    - `activeDoc`
    - `openPaths`
- useSyncStore — Computes sync plan and tracks upload progress.
  - State:
    - `filters: { include[], exclude[] }`
    - `plan: { dirsToCreate[], filesToUpload[{ path, size }], totalBytes }`
    - `progress: { current, total, currentPath, operation } | null`
    - `status: { phase, error?, cancelRequested? }`
    - `result: { lastSyncedAt, stats: { files, dirs, bytes, durationMs } } | null`

- useLspStore — LSP client holder with observable init and Monaco attach.
  - State:
    - `client (shallowRef)`
    - `phase: 'idle' | 'initializing' | 'providers' | 'ready' | 'error'`
    - `waiting: boolean`
    - `monacoAttached: boolean`
    - `lastError: string | null`
  - Note: Initialize client/workers before Monaco; attach providers when available. Diagnostics emitted before attach won’t render — set handler after attach and optionally refresh by re-sending open/change.

- OPFS API (service) — Direct Web API usage; feature-detect and throw/show error if unsupported.
